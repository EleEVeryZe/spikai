<div class="main-container">
  <!-- Header Card -->
  <div class="tema-header" *ngIf="tema">
    <mat-card class="header-card">
      <mat-card-content>
        <h1 class="tema-title-visual">{{ tema.titulo }}</h1>
        <p class="tema-description">Explore as atividades abaixo para dominar este tópico.</p>
        <div class="progress-bar-container">
          <mat-progress-bar mode="determinate" [value]="getTemaProgress()"></mat-progress-bar>
          <span class="progress-text">{{ getTemaProgress() }}% Completo</span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Activities Grid -->
  <div class="atividades-grid" *ngIf="tema">
    <mat-card class="atividade-card-visual" *ngFor="let atividade of tema.atividades; let i = index">
      <div class="atividade-icon-wrapper">
        <mat-icon class="activity-icon" [ngClass]="{ concluida: atividade.concluida, pendente: !atividade.concluida }">
          {{ getActivityIcon(atividade.nome) }}
        </mat-icon>
      </div>  

      <mat-card-content>
        <h2 class="atividade-title-visual">{{ atividade.nome }}</h2>
        <p class="tema-description">{{ getActivityDescription(atividade.nome) }}</p>
        <p
          class="atividade-pontos"
          *ngIf="atividade.ehAtividadeConcluida()"
          [ngClass]="{
            'baixo-desempenho': atividade.nome === 'Pós-teste' && atividade.obterNota() < 70
          }"
        >
          <mat-icon class="points-icon">emoji_events</mat-icon>
          Desempenho:
          <strong>{{ atividade.obterNota() }}%</strong>
        </p>

        <!-- Mensagem motivacional se pós-teste concluído e nota < 70% -->
        <p class="mensagem-reforco" *ngIf="atividade.nome === 'Pós-teste' && atividade.ehAtividadeConcluida() && atividade.obterNota() < 70">
          Refaça o Quizz ou assista novamente a aula. Se preferir, também é possível agendar uma aula reforço.!
        </p>
        <p class="atividade-status" *ngIf="atividade.ehAtividadeConcluida()">
          <mat-icon class="status-check">check_circle</mat-icon> Concluído em: {{ atividade.dataConclusao | date : "dd/MM/yyyy" }}
        </p>
        <p class="atividade-status" *ngIf="!atividade.ehAtividadeConcluida()">
          <mat-icon class="status-pending">radio_button_unchecked</mat-icon> Pendente
        </p>

        <button
          mat-flat-button
          color="primary"
          class="action-button"
          (click)="iniciarAtividade(atividade)"
        >
          {{ getCardBtnTxt(atividade.ehAtividadeConcluida()) }}
        </button>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Info / Error Messages -->
  <div class="info-message" *ngIf="!tema && !isLoadingTema">
    <mat-card class="error-card">
      <mat-card-content class="message-content">
        <mat-icon color="warn" class="message-icon">sentiment_dissatisfied</mat-icon>
        <h2>Oops! Tema não encontrado.</h2>
        <p>Parece que o tema que você está procurando não existe. Verifique o ID na URL.</p>
      </mat-card-content>
    </mat-card>
  </div>
</div>
